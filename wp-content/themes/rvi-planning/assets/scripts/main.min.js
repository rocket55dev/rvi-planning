jQuery(window).on('load', function () {
	let textarea = document.getElementById("g-recaptcha-response-100000");
	if ( textarea ) {
		textarea.setAttribute("aria-hidden", "true");
		textarea.setAttribute("aria-label", "do not use");
		textarea.setAttribute("aria-readonly", "true");
	}

	let iframe = jQuery('.grecaptcha-logo iframe');
	if ( iframe ) {
		iframe.attr('title', 'Protected by reCaptcha');
	}
});

/**
 * File js-enabled.js
 *
 * If Javascript is enabled, replace the <body> class "no-js".
 */
document.body.className = document.body.className.replace( 'no-js', 'js' );

/**
 * Modal.js
 */

// (function($){

// 	$(window).load(function(){
// 		/**
// 		 * Fancybox
// 		 */
// 		$( '[data-fancybox]' ).fancybox( {
// 			touch: false,
// 			afterShow: function() {
// 				$('.fancybox-button--close').focus();
// 			},
// 			autoFocus: false,
// 			baseTpl:
// 				'<div class="fancybox-container" role="dialog" aria-modal="true" aria-label="Product Video" tabindex="-1">' +
// 				'<div class="fancybox-bg"></div>' +
// 				'<div class="fancybox-inner">' +
// 				'<div class="fancybox-infobar"><span data-fancybox-index></span>&nbsp;/&nbsp;<span data-fancybox-count></span></div>' +
// 				'<div class="fancybox-toolbar">{{buttons}}</div>' +
// 				'<div class="fancybox-navigation">{{arrows}}</div>' +
// 				'<div class="fancybox-stage"></div>' +
// 				'<div class="fancybox-caption"></div>' +
// 				'</div>' +
// 				'</div>',
// 			btnTpl: {
// 				// Close Button
// 				close:
// 					'<button data-fancybox-close class="fancybox-button fancybox-button--close" aria-label="Close modal window" title="{{CLOSE}}">' +
// 					'<svg aria-hidden="true" width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">' +
// 					'<path d="M19.6927 1.4082L1.24542 19.8555" stroke="#343434" stroke-width="1.75688"/>' +
// 					'<path d="M19.6927 19.8555L1.24544 1.4082" stroke="#343434" stroke-width="1.75688"/>' +
// 					'</svg>' +
// 					'</button>',
// 				// Small Close Button
// 				smallBtn:
// 					'<button data-fancybox-close="" class="fancybox-close-small" aria-label="Close" title="Close">' +
// 					'<svg aria-hidden="true" width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">' +
// 					'<path d="M19.6927 1.4082L1.24542 19.8555" stroke="#343434" stroke-width="1.75688"/>' +
// 					'<path d="M19.6927 19.8555L1.24544 1.4082" stroke="#343434" stroke-width="1.75688"/>' +
// 					'</svg>' +
// 					'</button>',
// 			}
// 		} );
// 	});

// })(jQuery);

/**
 * File: navigation-primary.js
 *
 * Helpers for the primary navigation.
 */

const offcanvasElement = document.getElementById('offcanvasMenu');
const toggleButton = document.querySelector('[data-bs-target="#offcanvasMenu"]');

offcanvasElement.addEventListener('show.bs.offcanvas', () => {
    toggleButton.setAttribute('aria-expanded', 'true');
});

offcanvasElement.addEventListener('hide.bs.offcanvas', () => {
    toggleButton.setAttribute('aria-expanded', 'false');
});

/**
 * Post Navigation - Sticky sidebar navigation for blog posts
 *
 * Builds navigation from headings, implements scroll spy and smooth scrolling.
 */

(function() {
	'use strict';

	const nav = document.querySelector('.in-post-nav');
	const content = document.querySelector('.entry-content');

	if (!nav || !content) {
		return;
	}

	// Find all headings with post-heading IDs
	const headings = content.querySelectorAll('h2[id^="post-heading"], h3[id^="post-heading"], h4[id^="post-heading"]');

	if (!headings.length) {
		return;
	}

	// Build navigation HTML
	function buildNavigation() {
		// Create wrapper div
		const wrapper = document.createElement('div');
		wrapper.className = 'post-navigation';

		// Create title
		const title = document.createElement('h3');
		title.className = 'post-nav-title';
		title.textContent = 'Post Navigation';

		// Create list
		const navList = document.createElement('ul');
		navList.className = 'post-nav-list';

		// Add Intro item first (active by default)
		const introLi = document.createElement('li');
		introLi.className = 'post-nav-item post-nav-item--h2';

		const introLink = document.createElement('a');
		introLink.href = '#post-intro';
		introLink.className = 'post-nav-link active';
		introLink.textContent = 'Intro';

		introLi.appendChild(introLink);
		navList.appendChild(introLi);

		// Add ID to entry-content for intro link
		content.id = 'post-intro';

		headings.forEach(function(heading) {
			const li = document.createElement('li');
			const level = heading.tagName.toLowerCase();
			li.className = 'post-nav-item post-nav-item--' + level;

			const link = document.createElement('a');
			link.href = '#' + heading.id;
			link.className = 'post-nav-link';
			link.textContent = heading.textContent;

			li.appendChild(link);
			navList.appendChild(li);
		});

		// Assemble structure
		wrapper.appendChild(title);
		wrapper.appendChild(navList);
		nav.appendChild(wrapper);
	}

	// Handle smooth scrolling
	function initSmoothScroll() {
		nav.addEventListener('click', function(e) {
			if (e.target.classList.contains('post-nav-link')) {
				e.preventDefault();
				const targetId = e.target.getAttribute('href').substring(1);
				const targetElement = document.getElementById(targetId);

				if (targetElement) {
					const headerOffset = 100; // Adjust for fixed header
					const elementPosition = targetElement.getBoundingClientRect().top;
					const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

					window.scrollTo({
						top: offsetPosition,
						behavior: 'smooth'
					});
				}
			}
		});
	}

	// Scroll spy - highlight active section
	function initScrollSpy() {
		const navLinks = nav.querySelectorAll('.post-nav-link');
		const headerOffset = 150;

		function updateActiveLink() {
			let currentId = 'post-intro';

			// Find which heading we've scrolled past
			headings.forEach(function(heading) {
				const headingTop = heading.getBoundingClientRect().top;
				if (headingTop < headerOffset) {
					currentId = heading.id;
				}
			});

			// Update active states
			navLinks.forEach(function(link) {
				link.classList.remove('active');
				if (link.getAttribute('href') === '#' + currentId) {
					link.classList.add('active');
				}
			});
		}

		window.addEventListener('scroll', updateActiveLink);
		updateActiveLink(); // Run once on init
	}

	// Initialize
	buildNavigation();
	initSmoothScroll();
	initScrollSpy();

})();

/**
 * Global JS
 *
 */

(function($){

	$(window).on( 'load', function(){

		/**
		 * External Link Targeting
		 */
		const site_hostname = window.location.hostname;
		$( 'a:not([href*="' + site_hostname + '"]):not([href^="#"]):not([href^="/"])' ).attr( 'target', '_blank' );
		$( 'a[href$=".pdf"]' ).attr( 'target', '_blank' );

		/**
		 * CF7 a11y Fixes
		 */
		var wpcf7Elm = document.querySelector( '.wpcf7' ),
			screenReaderResponse = $( '.screen-reader-response' );
		if ( document.querySelector( '.wpcf7' ) ) {
			screenReaderResponse.attr( 'aria-hidden', 'true' );
			wpcf7Elm.addEventListener( 'wpcf7invalid', function( event ) {
				var error = $( '.wpcf7-not-valid-tip' ),
					message = $( '.wpcf7-response-output' ),
					badInput = $( 'input[aria-invalid="true"]');
				message.attr( 'role', 'alert' );
				error.removeAttr( 'aria-hidden' );
				badInput.removeAttr( 'aria-describedby' );
				setTimeout(function(){
					document.querySelector('input[aria-invalid="true"]').focus();
				}, 100);
			}, false );
		}

		function cf7ResponseMessage() {
			const response = $('.wpcf7-response-output');
			if ( document.querySelector( '.wpcf7' ) ) {
				response.attr('role', 'status');
				response.attr('aria-hidden', 'false');
			}
		}
		document.addEventListener( 'wpcf7invalid', cf7ResponseMessage, false );
		document.addEventListener( 'wpcf7spam', cf7ResponseMessage, false );
		document.addEventListener( 'wpcf7mailfailed', cf7ResponseMessage, false );
		document.addEventListener( 'wpcf7mailsent', cf7ResponseMessage, false );

	});

})(jQuery);

/**
 * File skip-link-focus-fix.js.
 *
 * Helps with accessibility for keyboard only users.
 *
 * Learn more: https://git.io/vWdr2
 */
( function() {
	var isWebkit = -1 < navigator.userAgent.toLowerCase().indexOf( 'webkit' ),
		isOpera = -1 < navigator.userAgent.toLowerCase().indexOf( 'opera' ),
		isIe = -1 < navigator.userAgent.toLowerCase().indexOf( 'msie' );

	if ( ( isWebkit || isOpera || isIe ) && document.getElementById && window.addEventListener ) {
		window.addEventListener( 'hashchange', function() {
			var id = location.hash.substring( 1 ),
				element;

			if ( ! ( /^[A-z0-9_-]+$/ ).test( id ) ) {
				return;
			}

			element = document.getElementById( id );

			if ( element ) {
				if ( ! ( /^(?:a|select|input|button|textarea)$/i ).test( element.tagName ) ) {
					element.tabIndex = -1;
				}

				element.focus();
			}
		}, false );
	}
}() );

/**
 * File window-ready.js
 *
 * Add a "ready" class to <body> when window is ready.
 */
window.wdsWindowReady = {};
( function( window, $, app ) {

	// Constructor.
	app.init = function() {
		app.cache();
		app.bindEvents();
	};

	// Cache document elements.
	app.cache = function() {
		app.$c = {
			'window': $( window ),
			'body': $( document.body )
		};
	};

	// Combine all events.
	app.bindEvents = function() {
		app.$c.window.load( app.addBodyClass );
	};

	// Add a class to <body>.
	app.addBodyClass = function() {
		app.$c.body.addClass( 'ready' );
	};

	// Engage!
	$( app.init );
}( window, jQuery, window.wdsWindowReady ) );
